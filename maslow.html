<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Maslow Code Quality Pyramid</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 40px; }
        .pyramid-container { 
            display: flex; 
            flex-direction: column-reverse; /* 1단계가 아래로 가도록 역순 배치 */
            gap: 12px; 
            max-width: 900px; 
            margin: 0 auto; 
        }
        .brick { 
            display: flex; 
            background: #fff; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            overflow: hidden; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .brick:hover { transform: translateY(-2px); }
        
        /* 단계별 색상 포인트 */
        .brick.l1 { border-left: 8px solid #ff4d4f; }
        .brick.l2 { border-left: 8px solid #ffa940; }
        .brick.l3 { border-left: 8px solid #ffec3d; }
        .brick.l4 { border-left: 8px solid #73d13d; }
        .brick.l5 { border-left: 8px solid #40a9ff; }

        .cell { 
            flex: 1; 
            padding: 15px; 
            border-right: 1px solid #f0f0f0; 
        }
        .cell:last-child { border-right: none; }
        
        .label { 
            font-size: 0.75rem; 
            font-weight: bold; 
            color: #8c8c8c; 
            margin-bottom: 8px; 
            text-transform: uppercase;
        }
        .content { 
            font-size: 0.95rem; 
            color: #262626; 
            line-height: 1.5; 
            word-break: keep-all;
        }
    </style>
</head>
<body>
    <div id="pyramid" class="pyramid-container">
        </div>

    <script>
        const Store = {
            maslowData: [],
            traces: [] 
        };

        const MaslowApp = {
            async request(path) {
                try {
                    const res = await fetch(path);
                    
                    const traceHeader = res.headers.get('X-Sequence-Trace');
                    if (traceHeader) {
                        Store.traces = JSON.parse(traceHeader);
                    }

                    if (!res.ok) {
                        // [개선] 추상적인 에러 대신 상태 코드와 경로를 정찰 데이터에 수동 병합
                        this.pushClientError("HTTP_ERROR", { status: res.status, path: path });
                        return null;
                    }
                    return await res.json();
                } catch (e) {
                    // [개선] 네트워크 단절 등 물리적 장애 발생 시 구체적 원인 기록
                    this.pushClientError("NETWORK_FAILURE", { message: e.message, target: path });
                    return null;
                }
            },

            // 클라이언트에서 감지된 문제를 정찰 규격에 맞춰 적재하는 유틸리티
            pushClientError(event, data) {
                Store.traces.push({
                    event: `SIGNAL_${event}`,
                    data: data
                });
                this.render();
            },

            async init() {
                const data = await this.request('/maslow.json');
                if (data) {
                    Store.maslowData = data;
                    this.render();
                }
            },

            render() {
                const pyramidContainer = document.getElementById('pyramid');
                const logContainer = document.getElementById('recon-log-area');

                if (pyramidContainer) {
                    pyramidContainer.innerHTML = Store.maslowData.map(item => `
                        <div class="brick l${item.level}">
                            <div class="cell">
                                <div class="label">${item.level}단계. ${item.step_name}</div>
                                <div class="content">${item.step_desc}</div>
                            </div>
                            <div class="cell">
                                <div class="label">AI 분석: 코드의 호흡</div>
                                <div class="content">${item.analogy}</div>
                            </div>
                            <div class="cell">
                                <div class="label">성찰</div>
                                <div class="content">${item.thought}</div>
                            </div>
                        </div>
                    `).join('');
                }
            }
        };

        MaslowApp.init();
    </script>

</body>
</html>